name: Integration tests

on: [push]

jobs:
  test:
    runs-on: ubuntu-20.04

    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-python@v2
      with:
        python-version: '3.7'
    - name: Install dependencies
      run: |
        sudo apt-get update && sudo apt-get --assume-yes install samtools
        python -m pip install --upgrade pip
        pip install poetry
        sudo apt-get install -y r-base
        R --slave -e 'install.packages("remotes")'
        R --slave -e 'remotes::install_version("optparse", "1.3.2")'
        R --slave -e 'remotes::install_version("tidyverse", "1.2.1")'
        R --slave -e 'remotes::install_version("XML", "3.99-0.9")'
        R --slave -e 'remotes::install_version("randomForest", "4.6-14")'
    - name: Build and install
      run: |
        poetry build
        pip install dist/easy_fuse*.whl
    - name: Run integration tests
      run: |
        make clean integration_tests
